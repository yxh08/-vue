{
  "version": 3,
  "sources": ["../src/effect.ts", "../src/system.ts", "../src/ref.ts"],
  "sourcesContent": ["export let activeSub : ReactivityEffect\r\n\r\nexport const effect = (fn :Function) => {\r\n  const e = new ReactivityEffect(fn)\r\n  e.run()\r\n}\r\n\r\nexport class ReactivityEffect {\r\n  constructor(public fn :Function) {}\r\n\r\n  run() {\r\n    const prevActiveSub = activeSub\r\n    activeSub = this\r\n    this.fn()\r\n    activeSub = prevActiveSub\r\n  }\r\n}\r\n", "import { activeSub } from './effect';\r\nimport { ReactivityEffect } from './effect';\r\nimport { RefImpl } from './ref';\r\n\r\nexport interface SubNode {\r\n  prevSub: SubNode | undefined;\r\n  sub: ReactivityEffect;\r\n  nextSub: SubNode | undefined;\r\n}\r\n\r\n//\u6536\u96C6\u4F9D\u8D56\r\nexport const collect = (refObj: RefImpl) => {\r\n  const newSub: SubNode = {\r\n    prevSub: undefined,\r\n    sub: activeSub,\r\n    nextSub: undefined,\r\n  };\r\n\r\n  if (!refObj.headSub) {\r\n    refObj.headSub = newSub;\r\n    refObj.tailSub = newSub;\r\n  } else {\r\n    refObj.tailSub!.nextSub = newSub;\r\n    newSub.prevSub = refObj.tailSub;\r\n    refObj.tailSub = newSub;\r\n  }\r\n};\r\n\r\n//\u89E6\u53D1\u4F9D\u8D56\r\nexport const trigger = (refObj: RefImpl) => {\r\n  if (refObj.headSub) {\r\n    let curSub = refObj.headSub;\r\n    let queue = [];\r\n    while (curSub?.sub) {\r\n      queue.push(curSub.sub);\r\n      curSub = curSub.nextSub!;\r\n    }\r\n    console.log('\u5F85\u6267\u884C\u961F\u5217', queue);\r\n    for (let i = 0; i <= queue.length - 1; i++) {\r\n      queue[i].run();\r\n    }\r\n  }\r\n};\r\n", "import { activeSub, ReactivityEffect } from './effect';\r\nimport { collect, trigger } from './system';\r\nimport { SubNode } from './system';\r\nexport const ref = (value: any) => {\r\n  return new RefImpl(value);\r\n};\r\nexport class RefImpl {\r\n  headSub: SubNode | undefined;\r\n  tailSub: SubNode | undefined;\r\n  constructor(public _value: any) {}\r\n  get value() {\r\n    //\u6536\u96C6\u4F9D\u8D56\r\n    if (activeSub) {\r\n      collect(this);\r\n    }\r\n    return this._value;\r\n  }\r\n  set value(newValue) {\r\n    this._value = newValue;\r\n    //\u89E6\u53D1\u4F9D\u8D56\r\n    trigger(this);\r\n  }\r\n}\r\n"],
  "mappings": ";AAAO,IAAI;AAEJ,IAAM,SAAS,CAAC,OAAiB;AACtC,QAAM,IAAI,IAAI,iBAAiB,EAAE;AACjC,IAAE,IAAI;AACR;AAEO,IAAM,mBAAN,MAAuB;AAAA,EAC5B,YAAmB,IAAc;AAAd;AAAA,EAAe;AAAA,EAElC,MAAM;AACJ,UAAM,gBAAgB;AACtB,gBAAY;AACZ,SAAK,GAAG;AACR,gBAAY;AAAA,EACd;AACF;;;ACLO,IAAM,UAAU,CAAC,WAAoB;AAC1C,QAAM,SAAkB;AAAA,IACtB,SAAS;AAAA,IACT,KAAK;AAAA,IACL,SAAS;AAAA,EACX;AAEA,MAAI,CAAC,OAAO,SAAS;AACnB,WAAO,UAAU;AACjB,WAAO,UAAU;AAAA,EACnB,OAAO;AACL,WAAO,QAAS,UAAU;AAC1B,WAAO,UAAU,OAAO;AACxB,WAAO,UAAU;AAAA,EACnB;AACF;AAGO,IAAM,UAAU,CAAC,WAAoB;AAC1C,MAAI,OAAO,SAAS;AAClB,QAAI,SAAS,OAAO;AACpB,QAAI,QAAQ,CAAC;AACb,WAAO,QAAQ,KAAK;AAClB,YAAM,KAAK,OAAO,GAAG;AACrB,eAAS,OAAO;AAAA,IAClB;AACA,YAAQ,IAAI,kCAAS,KAAK;AAC1B,aAAS,IAAI,GAAG,KAAK,MAAM,SAAS,GAAG,KAAK;AAC1C,YAAM,CAAC,EAAE,IAAI;AAAA,IACf;AAAA,EACF;AACF;;;ACvCO,IAAM,MAAM,CAAC,UAAe;AACjC,SAAO,IAAI,QAAQ,KAAK;AAC1B;AACO,IAAM,UAAN,MAAc;AAAA,EAGnB,YAAmB,QAAa;AAAb;AAAA,EAAc;AAAA,EACjC,IAAI,QAAQ;AAEV,QAAI,WAAW;AACb,cAAQ,IAAI;AAAA,IACd;AACA,WAAO,KAAK;AAAA,EACd;AAAA,EACA,IAAI,MAAM,UAAU;AAClB,SAAK,SAAS;AAEd,YAAQ,IAAI;AAAA,EACd;AACF;",
  "names": []
}

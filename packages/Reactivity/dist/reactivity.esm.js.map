{
  "version": 3,
  "sources": ["../src/effect.ts", "../src/ref.ts"],
  "sourcesContent": ["export let activeSub\r\n\r\nexport const effect = fn => {\r\n  const e = new ReactivityEffect(fn)\r\n  e.run()\r\n}\r\n\r\nclass ReactivityEffect {\r\n  constructor(public fn) {}\r\n\r\n  run() {\r\n    const prevActiveSub = activeSub\r\n    activeSub = this\r\n    this.fn()\r\n    activeSub = prevActiveSub\r\n  }\r\n}\r\n", "import { activeSub } from './effect'\r\n\r\nexport const ref = value => {\r\n  return new RefImpl(value)\r\n}\r\nclass RefImpl {\r\n  headSub: undefined\r\n  tailSub: undefined\r\n  constructor(public _value) {}\r\n  get value() {\r\n    //\u6536\u96C6\u4F9D\u8D56\r\n    if (activeSub) {\r\n      collect(this)\r\n    }\r\n    return this._value\r\n  }\r\n  set value(newValue) {\r\n    this._value = newValue\r\n    //\u89E6\u53D1\u4F9D\u8D56\r\n    trigger(this)\r\n  }\r\n}\r\n\r\ninterface SubNode {\r\n  prevSub: SubNode | undefined\r\n  sub: Function | ReactivityEffect\r\n  nextSub: SubNode | undefined\r\n}\r\n\r\n//\u6536\u96C6\u4F9D\u8D56\r\nexport const collect = refObj => {\r\n  const newSub: SubNode = {\r\n    prevSub: undefined,\r\n    sub: activeSub,\r\n    nextSub: undefined,\r\n  }\r\n\r\n  if (!refObj.headSub) {\r\n    refObj.headSub = newSub\r\n    refObj.tailSub = newSub\r\n  } else {\r\n    refObj.tailSub.nextSub = newSub\r\n    newSub.prevSub = refObj.tailSub\r\n    refObj.tailSub = newSub\r\n  }\r\n}\r\n\r\n//\u89E6\u53D1\u4F9D\u8D56\r\nexport const trigger = refObj => {\r\n  if (refObj.headSub) {\r\n    let curSub = refObj.headSub\r\n    let queue = []\r\n    while (curSub?.sub) {\r\n      queue.push(curSub.sub)\r\n      curSub = curSub.nextSub\r\n    }\r\n    console.log('\u5F85\u6267\u884C\u961F\u5217', queue)\r\n    for (let i = 0; i <= queue.length - 1; i++) {\r\n      queue[i].run()\r\n    }\r\n  }\r\n}\r\n"],
  "mappings": ";AAAO,IAAI;AAEJ,IAAM,SAAS,QAAM;AAC1B,QAAM,IAAI,IAAI,iBAAiB,EAAE;AACjC,IAAE,IAAI;AACR;AAEA,IAAM,mBAAN,MAAuB;AAAA,EACrB,YAAmB,IAAI;AAAJ;AAAA,EAAK;AAAA,EAExB,MAAM;AACJ,UAAM,gBAAgB;AACtB,gBAAY;AACZ,SAAK,GAAG;AACR,gBAAY;AAAA,EACd;AACF;;;ACdO,IAAM,MAAM,WAAS;AAC1B,SAAO,IAAI,QAAQ,KAAK;AAC1B;AACA,IAAM,UAAN,MAAc;AAAA,EAGZ,YAAmB,QAAQ;AAAR;AAAA,EAAS;AAAA,EAC5B,IAAI,QAAQ;AAEV,QAAI,WAAW;AACb,cAAQ,IAAI;AAAA,IACd;AACA,WAAO,KAAK;AAAA,EACd;AAAA,EACA,IAAI,MAAM,UAAU;AAClB,SAAK,SAAS;AAEd,YAAQ,IAAI;AAAA,EACd;AACF;AASO,IAAM,UAAU,YAAU;AAC/B,QAAM,SAAkB;AAAA,IACtB,SAAS;AAAA,IACT,KAAK;AAAA,IACL,SAAS;AAAA,EACX;AAEA,MAAI,CAAC,OAAO,SAAS;AACnB,WAAO,UAAU;AACjB,WAAO,UAAU;AAAA,EACnB,OAAO;AACL,WAAO,QAAQ,UAAU;AACzB,WAAO,UAAU,OAAO;AACxB,WAAO,UAAU;AAAA,EACnB;AACF;AAGO,IAAM,UAAU,YAAU;AAC/B,MAAI,OAAO,SAAS;AAClB,QAAI,SAAS,OAAO;AACpB,QAAI,QAAQ,CAAC;AACb,WAAO,QAAQ,KAAK;AAClB,YAAM,KAAK,OAAO,GAAG;AACrB,eAAS,OAAO;AAAA,IAClB;AACA,YAAQ,IAAI,kCAAS,KAAK;AAC1B,aAAS,IAAI,GAAG,KAAK,MAAM,SAAS,GAAG,KAAK;AAC1C,YAAM,CAAC,EAAE,IAAI;AAAA,IACf;AAAA,EACF;AACF;",
  "names": []
}

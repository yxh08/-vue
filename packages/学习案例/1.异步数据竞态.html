<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0"
    />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Document</title>
  </head>
  <body>
    <script>
      /**
       * 创建竞态函数
       * @param asyncFn 异步函数
       *
       */

      function createCancelTask(asyncFn) {
        let cancel = () => {}
        return function (...args) {
          return new Promise((resolve, reject) => {
            cancel()
            cancel = () => {
              resolve = reject = () => {}
            }
            asyncFn(...args).then(
              res => {
                resolve(res)
              },
              err => {
                reject(err)
              },
            )
          })
        }
      }

      //创建异步任务
      const task = createCancelTask(
        param =>
          new Promise(resolve => {
            setTimeout(() => {
              resolve(param)
            }, param * 1000)
          }),
      )

      task(1).then(res => {
        console.log(res)
      })
      task(2).then(res => {
        console.log(res)
      })
      task(3).then(res => {
        console.log(res)
      })
      console.log('start')
    </script>
  </body>
</html>
